apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: es-client
  labels:
    component: elasticsearch
    role: client
spec:
  template:
    metadata:
      labels:
        component: elasticsearch
        role: client
      annotations:
        pod.beta.kubernetes.io/init-containers: '[
          {
          "name": "sysctl",
            "image": "busybox",
            "imagePullPolicy": "IfNotPresent",
            "command": ["sysctl", "-w", "vm.max_map_count=262144"],
            "securityContext": {
              "privileged": true
            }
          }
        ]'
    spec:
      containers:
      - name: es-client
        securityContext:
          privileged: true
          capabilities:
            add:
              - IPC_LOCK
        image: ackee/ackeelastic:latest
#        imagePullPolicy: Always
        resources:
           requests:
             cpu: 10m
             memory: 1024Mi
           limits:
             cpu: 100m
             memory: 2048Mi
        env:
        - name: NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: "GS_CRED_FILE_CONTENT"
          value: "ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAiaW5mcmFzdHJ1a3R1cmEtMTMwNyIsCiAgInByaXZhdGVfa2V5X2lkIjogIjc3NGNhOWI1N2EwNTQ5NDEwZjNlMzczYmQ2OWFhMmZiYjZlNTI1NzkiLAogICJwcml2YXRlX2tleSI6ICItLS0tLUJFR0lOIFBSSVZBVEUgS0VZLS0tLS1cbk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRREVrTG5GT1JlS25XUHpcbklFb3J4aEZib01tektyOEloMDVYeUNQWlZFMjNtbDAvcCtyOFNEbnd1dU4wb3lRUjRQQnAvZHhtQ0E5dCtiWkdcbkJiTmt0UkZ3ekRFN3VZVDZMckRjS1VDdzA5dHRmSlJMTXFHVkRyVkxPSDdVUCtNZ2p0TGpHUm5tNjdWV1pIL3VcbnYvNzBrOUtGanI2TEpQOTdnZGNNOGJ5cVlxbkxVNkhBTllSbnRXejRCaExkV0ZLL2ovRUQ1Sk1QSkg2N3FwcGlcbjY1alhWQWF3VnozYndxMzRTQUVaWVphSkRpWGhucDZSczNzTnJtZnRWNTlyOU92c0R2Q2hLdVlUQXIrd1Z3RXFcbkNvMWp2WUdDbXZSM2Z4U3ZOcUVnbmR5VE9SMW1MUUV1Zys5cEhyYldLM0NuNWxVdUMvQkpQa1RqRThGYTlDSllcbk11ZlJCSlFIQWdNQkFBRUNnZ0VBUmVWUXFaakxqamE1TzlMWGpRazVVdU94MVV2MThncHJDVHZadzRYK3ZMTGZcblJhdG9HNTF6UE82M3d0bmdFWnR5NGIycmlYeUVRQTd6aWFLdFQ3b3pJWEQ2Y01wZlJyY2puS1h1b3ZJeXJKUUlcbkIxVlJyN2N6TURRK3BTcXlrUGs0ZEJpUTVWUWJmMFR0V1BCY3NJdC82STRCbzJqY2tBWnplZDdidjVxbDFlNmVcbjFuUTdrZ1VtSm5EZHVLUDhVZlRGYjU2UElIQ3R4dlRiWnVQblp4elpEallrOTdaV1pseUZPNGVYRkpTd29YNmhcbkcyZ25JTjdPZSttVWd1akp6MVZ3Y0VvWVIwRjk2NkVyMEEwd2x6ZG9yQlVpQzM2WmwvL1pZWGttaXFnV2tzUGhcbkdtb1dkMDVqa2RFTjU1eitSVldSRDhLVXFOdjNTZzlKMm1iNlF1WW53UUtCZ1FENEM2WjJGcUlPZnFOSlNVUDhcblFpK1hnRzR6K2Q5NHYxK3c0VTZNcGpNRTRhZXpiWnlVTDFiclREMFdxZzF3UmxleC9uby9IWWYzUVdmWlYvY0dcbjdJT3I1OUZ3a3pZYlM1NTAvNTgwOElsSFV4STk1bk9NMjlXc1RWY1pYVE16eDhDSmJvaVRNYXBLMkd1a3JkdGxcbnNnWGt5dUFWYWlHQytqZ21nYmgxYmdUQ1hRS0JnUURLM25IYlhVaUpKVFN4Q3ZjRXlEMWhIR3ZBWVIwbEF3ZlZcbkU1ZkxJRXY2dmtLMVFKYjJPcUQ4T2lhcSthMXRrRFpKTGlWQjBKK01hWlhISzlaaU9vVmlBMzV6ZG8xbDhPY0xcbkRjSkE3K2lQNjRtY3oyOGgvR2RiUi9TdVFOajl6T0xqM1FrbDQrbmphNk9BZXBVRmJldWNMVGFBakxaN2VqeFdcbkV1NlRVbUtSc3dLQmdCc3ltOVFDODA0SGtMdnVicWZ3VWV1WXgzeW5mMXRzRUlBQ2xHeFRwUEI2RmJ0VTM0QllcbkdIM0FaRXBoNXd0U2l6Y1hJaXhkZnBVYjlOa2VEaFlTUlBYS2UycU9tYll3ZW5WMXVlMUNHcXRaYm55ZkVqaDFcbnVsNGtOTkt4SjNZY0J2Nkt3aXJ4blN5THduSFNKbVptT01NM2c0NlZqb3NnQ0p3Z1NTdUhIcnA1QW9HQkFMUGdcbjlWZXFxT3hoL3d5VVNsOEZKZGQ3bWRja3hQRFNkUmxybkFaU0JzeTM4dkkvNlJzKzlRdHdqR1RCcWhNaDhlQ0ZcbmVDZVpVajd3U0F3b1JKa29ocWhYck1HNGRydlRGU25wOHpvYy96ck5nR0Y0VkhQd0Y3MEtXbHcveDZlVENnTTlcbk5DVlNwMG90WVBaRXV1bnJneVFodXRmVTdPRWppMmhPdFJnUHpyS2RBb0dBVFJIeHdSZzMvbWgxOC9Sd2ZTMk9cbk1LWTkwOVVsODRvZWlrT2ZmYldWc0Nsd1BHVmovaU83Unp3a1Bpd2NXcGdVWnBYL3NQUy9pVnVJTklqZmU4cVVcblJHMHJtUXcybENWc2xFZ1N1SmVDSER6dERmOXFFNVExWW1rTGExSmVJcmIxT1VvWmZkNjhyZGFrUlZSMVMzRGRcbjhWelgyRmlZbVJIZXpHV0FzOW1QTTdrPVxuLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLVxuIiwKICAiY2xpZW50X2VtYWlsIjogImVzLXNuYXBAaW5mcmFzdHJ1a3R1cmEtMTMwNy5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgImNsaWVudF9pZCI6ICIxMTE2MjMwNjk2MDY5NzM0NzcxMzgiLAogICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsCiAgInRva2VuX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvdG9rZW4iLAogICJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwKICAiY2xpZW50X3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vcm9ib3QvdjEvbWV0YWRhdGEveDUwOS9lcy1zbmFwJTQwaW5mcmFzdHJ1a3R1cmEtMTMwNy5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIKfQo="
        - name: "CLUSTER_NAME"
          value: "myesdb"
        - name: NODE_MASTER
          value: "false"
        - name: NODE_DATA
          value: "false"
        - name: HTTP_ENABLE
          value: "true"
        - name: "ES_JAVA_OPTS"
          value: "-Xms1024m -Xmx1024m"
        ports:
        - containerPort: 9200
          name: http
          protocol: TCP
        - containerPort: 9300
          name: transport
          protocol: TCP
        volumeMounts:
        - name: storage
          mountPath: /data
      volumes:
          - emptyDir:
              medium: ""
            name: "storage"
